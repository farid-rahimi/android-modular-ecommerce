package com.solutionium.feature.category

import com.solutionium.sharedui.common.component.SearchAppBar
import androidx.activity.compose.BackHandler
import androidx.compose.foundation.background
import androidx.compose.foundation.clickable
import androidx.compose.foundation.layout.Arrangement
import androidx.compose.foundation.layout.Box
import androidx.compose.foundation.layout.Column
import androidx.compose.foundation.layout.PaddingValues
import androidx.compose.foundation.layout.Row
import androidx.compose.foundation.layout.Spacer
import androidx.compose.foundation.layout.aspectRatio
import androidx.compose.foundation.layout.fillMaxSize
import androidx.compose.foundation.layout.fillMaxWidth
import androidx.compose.foundation.layout.height
import androidx.compose.foundation.layout.heightIn
import androidx.compose.foundation.layout.padding
import androidx.compose.foundation.layout.size
import androidx.compose.foundation.layout.width
import androidx.compose.foundation.lazy.LazyColumn
import androidx.compose.foundation.lazy.LazyRow
import androidx.compose.foundation.lazy.items
import androidx.compose.foundation.shape.RoundedCornerShape
import androidx.compose.material.icons.Icons
import androidx.compose.material.icons.automirrored.filled.ArrowForward
import androidx.compose.material.icons.outlined.Search
import androidx.compose.material3.Card
import androidx.compose.material3.CardDefaults
import androidx.compose.material3.CircularProgressIndicator
import androidx.compose.material3.HorizontalDivider
import androidx.compose.material3.Icon
import androidx.compose.material3.MaterialTheme
import androidx.compose.material3.Scaffold
import androidx.compose.material3.Text
import androidx.compose.material3.TextButton
import androidx.compose.material3.pulltorefresh.PullToRefreshBox
import androidx.compose.runtime.Composable
import androidx.compose.runtime.collectAsState
import androidx.compose.runtime.getValue
import androidx.compose.ui.Alignment
import androidx.compose.ui.Alignment.Companion.CenterHorizontally
import androidx.compose.ui.Modifier
import androidx.compose.ui.draw.clip
import androidx.compose.ui.graphics.Brush
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.graphics.painter.ColorPainter
import androidx.compose.ui.layout.ContentScale
import androidx.compose.ui.platform.LocalContext
import androidx.compose.ui.res.stringResource
import androidx.compose.ui.text.font.FontWeight
import androidx.compose.ui.text.style.TextAlign
import androidx.compose.ui.unit.dp
import androidx.compose.ui.unit.sp
import androidx.lifecycle.compose.collectAsStateWithLifecycle
import coil3.compose.AsyncImage
import coil3.request.ImageRequest
import coil3.request.crossfade
import com.solutionium.sharedui.common.component.CategoryScreenPlaceholder
import com.solutionium.sharedui.common.component.PerfumeAttributes
import com.solutionium.sharedui.common.component.PriceView
import com.solutionium.sharedui.common.component.ShoeAttributes
import com.solutionium.shared.data.model.AttributeTerm
import com.solutionium.shared.data.model.DisplayableTerm
import com.solutionium.shared.data.model.PERFUME_CAT_ID
import com.solutionium.shared.data.model.PRODUCT_ARG_ATTRIBUTE
import com.solutionium.shared.data.model.PRODUCT_ARG_ATTRIBUTE_TERM
import com.solutionium.shared.data.model.PRODUCT_ARG_BRAND_ID
import com.solutionium.shared.data.model.PRODUCT_ARG_CATEGORY
import com.solutionium.shared.data.model.PRODUCT_ARG_SEARCH
import com.solutionium.shared.data.model.PRODUCT_ARG_TITLE
import com.solutionium.shared.data.model.ProductCatType
import com.solutionium.shared.data.model.ProductThumbnail
import com.solutionium.shared.data.model.SHOES_CAT_ID


@Composable
fun CategoryScreen(
    navigateToProductList: (Map<String, String>) -> Unit = {},
    onProductClick: (productId: Int) -> Unit = {},
    onNavigateBack: () -> Unit = {}, // Optional if it's a top-level screen
    viewModel: CategoryViewModel
) {
    val uiState by viewModel.uiState.collectAsStateWithLifecycle()

    BackHandler(enabled = uiState.searchQuery.isNotEmpty()) {
        viewModel.clearSearch()
    }

    val searchTitle = stringResource(R.string.search, uiState.searchQuery)

    val isRefreshing by viewModel.isRefreshing.collectAsState() // <-- Collect the refreshing state


    Scaffold(
        topBar = {
            Spacer(modifier = Modifier.height(12.dp))
            SearchAppBar(
                query = uiState.searchQuery,
                onQueryChanged = viewModel::onSearchQueryChanged,
                onSearch = {
                    navigateToProductList(
                        mapOf(
                            PRODUCT_ARG_SEARCH to uiState.searchQuery,
                            PRODUCT_ARG_TITLE to searchTitle,
                        )
                    )
                },
                onClose = {
                    if (uiState.searchQuery.isNotEmpty()) {
                        viewModel.clearSearch()
                    } else {
                        onNavigateBack()
                    }
                }
            )
        }
    ) { paddingValues ->
        PullToRefreshBox(
            modifier = Modifier
                .fillMaxSize(),
            isRefreshing = isRefreshing,
            onRefresh = { viewModel.refresh() }
        ) {
            Box(
                modifier = Modifier
                    .fillMaxSize()
                    .padding(paddingValues)
                    .background(MaterialTheme.colorScheme.surface)
            ) {
                CategoryContent(
                    uiState = uiState,
                    navigateToProductList = navigateToProductList,
                    onProductClick = onProductClick,
                    onNavigateBack = onNavigateBack,
                    viewModel = viewModel
                )

                if (uiState.searchQuery.isNotBlank()) {
                    SearchPreview(
                        isLoading = uiState.isSearching,
                        results = uiState.searchResults,
                        onProductClick = onProductClick,
                        onShowAllClick = {
                            navigateToProductList(
                                mapOf(
                                    PRODUCT_ARG_SEARCH to uiState.searchQuery,
                                    PRODUCT_ARG_TITLE to searchTitle,
                                )
                            )
                        },
                        showStock = uiState.isSuperUser
                    )
                }

            }
        }
    }
}

@Composable
fun SearchPreview(
    isLoading: Boolean,
    results: List<ProductThumbnail>,
    onProductClick: (Int) -> Unit,
    onShowAllClick: () -> Unit,
    showStock: Boolean = false
) {
    LazyColumn(
        modifier = Modifier
            .fillMaxSize()
            .background(MaterialTheme.colorScheme.surface)
    ) {
        if (isLoading) {
            item {
                Box(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(16.dp), contentAlignment = Alignment.Center
                ) {
                    CircularProgressIndicator()
                }
            }
        } else if (results.isNotEmpty()) {
            items(results, key = { it.id }) { product ->
                // Use the new custom composable here
                SearchPreviewItem(
                    product = product,
                    onClick = { onProductClick(product.id) },
                    showStock = showStock
                )
                HorizontalDivider(modifier = Modifier.padding(horizontal = 16.dp))
            }
            item {
                TextButton(onClick = onShowAllClick, modifier = Modifier.fillMaxWidth()) {
                    Text(stringResource(R.string.show_all_results))
                }
            }
        } else {
            item {
                // You can make this more engaging
                Column(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(top = 64.dp),
                    horizontalAlignment = CenterHorizontally,
                    verticalArrangement = Arrangement.Center
                ) {
                    Icon(
                        imageVector = Icons.Outlined.Search,
                        contentDescription = "No results",
                        modifier = Modifier.size(48.dp),
                        tint = Color.Gray
                    )
                    Spacer(modifier = Modifier.height(16.dp))
                    Text(
                        text = stringResource(R.string.no_results_found),
                        style = MaterialTheme.typography.titleMedium,
                        color = Color.Gray,
                        modifier = Modifier.padding(16.dp)
                    )
                }
            }
        }
    }
}

@Composable
fun SearchPreviewItem(
    product: ProductThumbnail,
    onClick: () -> Unit,
    showStock: Boolean = false
) {
    Row(
        modifier = Modifier
            .fillMaxWidth()
            .clickable(onClick = onClick)
            .padding(horizontal = 16.dp, vertical = 8.dp), // Add padding for spacing
        verticalAlignment = Alignment.CenterVertically
    ) {
        // Product Image Thumbnail
        AsyncImage(
            model = ImageRequest.Builder(LocalContext.current)
                .data(product.imageUrl)
                .crossfade(true)
                .build(),
            placeholder = ColorPainter(MaterialTheme.colorScheme.surfaceContainer),
            error = ColorPainter(MaterialTheme.colorScheme.surfaceContainer),
            contentDescription = product.name,
            contentScale = ContentScale.Crop,
            modifier = Modifier
                .size(64.dp) // A good size for a thumbnail in a list
                .clip(RoundedCornerShape(8.dp)) // Soften the corners
        )

        Spacer(modifier = Modifier.width(16.dp))

        // Product Name and Price
        Column(
            modifier = Modifier.weight(1f) // Allow text to take remaining space
        ) {
            Text(
                text = product.name,
                style = MaterialTheme.typography.bodyLarge,
                fontWeight = FontWeight.SemiBold,
                color = MaterialTheme.colorScheme.onSurface
            )

            if (showStock) {
                val stockText = if (product.manageStock && product.stock > 0) {
                    stringResource(
                        com.solutionium.core.ui.common.R.string.in_stock_count,
                        product.stock
                    )
                } else if (!product.manageStock && product.stockStatus == "instock") {
                    stringResource(com.solutionium.core.ui.common.R.string.in_stock)
                } else {
                    stringResource(com.solutionium.core.ui.common.R.string.out_of_stock)
                }
                Text(
                    text = stockText,
                    fontSize = 12.sp,
                    fontWeight = FontWeight.SemiBold,
                    color = if (product.manageStock && product.stock > 0 || (!product.manageStock && product.stockStatus == "instock")) Color(
                        0xFF4CAF50
                    ) else Color(0xFFF44336), // Green or Red
                    //color = if (product.stock > 0) Color(0xFF4CAF50) else Color(0xFFF44336), // Green or Red
                    modifier = Modifier.heightIn(min = 18.dp) // Ensure consistent height
                )
            }

            Spacer(modifier = Modifier.height(4.dp))
            Row(

                modifier = Modifier.fillMaxWidth()
            ) {

                PriceView(product.price, product.onSale, product.regularPrice)
                Spacer(modifier = Modifier.weight(1f))
                when (product.type) {
                    ProductCatType.PERFUME -> PerfumeAttributes(product, onlyVolume = true)
                    ProductCatType.SHOES -> ShoeAttributes(product)
                    else -> {}
                }
            }

        }
    }
}


@Composable
fun CategoryContent(
    uiState: CategoryScreenState,
    navigateToProductList: (Map<String, String>) -> Unit = {},
    onProductClick: (productId: Int) -> Unit = {},
    onNavigateBack: () -> Unit = {}, // Optional if it's a top-level screen
    viewModel: CategoryViewModel
) {

    if (uiState.isLoading) {
        CategoryScreenPlaceholder()
    } else if (uiState.error != null) {
        Text(
            text = uiState.error.toString(),
            color = MaterialTheme.colorScheme.error,
            modifier = Modifier
                //.align(Alignment.Center)
                .padding(16.dp)
        )
    } else {

        val allPerfumeTitle = stringResource(R.string.all_perfumes_title)
        val allShoesTitle = stringResource(R.string.all_shoes_title)


        BackHandler(enabled = uiState.categoryDisplayType != CategoryDisplayType.MAIN) {
            // When back is pressed, simply call the ViewModel function to reset the state.
            viewModel.backToMainDisplay()
        }

        when (uiState.categoryDisplayType) {
            CategoryDisplayType.MAIN -> {
                LazyColumn(
                    modifier = Modifier.fillMaxSize(),
                    contentPadding = PaddingValues(vertical = 16.dp), // Only vertical, horizontal in sections
                    verticalArrangement = Arrangement.spacedBy(24.dp)
                ) {


                    // --- Perfume Spotlight Section ---
                    item {
                        PerfumeSpotlightSection(
                            spotlightTerms = uiState.perfumeSpotlightTerms,
                            title = stringResource(R.string.discover_perfume_collections),
                            imageFinder = { uiState.images[it] },
                            onCategoryClick = { termId, title ->
                                navigateToProductList(
                                    mapOf(
                                        PRODUCT_ARG_ATTRIBUTE to "pa_gender",
                                        PRODUCT_ARG_ATTRIBUTE_TERM to termId.toString(),
                                        PRODUCT_ARG_TITLE to title
                                    )
                                )
                                //onNavigateToProductList(null, "pa_gender", termId, title)
                            },
                            onShopAllPerfumesClick = {
                                navigateToProductList(
                                    mapOf(
                                        PRODUCT_ARG_CATEGORY to PERFUME_CAT_ID,
                                        PRODUCT_ARG_TITLE to allPerfumeTitle
                                    )
                                )
                            }
                        )
                    }

                    // --- Perfume Brands ---
                    item {
                        SmallItemsSection(
                            title = stringResource(R.string.brands_title),
                            items = uiState.perfumeBrands,
                            onClick = { brandId, title ->
                                navigateToProductList(
                                    mapOf(
                                        PRODUCT_ARG_BRAND_ID to brandId.toString(),
                                        PRODUCT_ARG_TITLE to title,
                                    )
                                )
                                //onNavigateToProductList(brandId, null, null, title)
                            },
                            onViewAllClick = {
                                viewModel.goToAllBrands()
                            },
                            viewAllText = stringResource(R.string.show_all_brands_text),
                        )
                    }

                    // --- Top Scent Section ---
                    item {
                        ItemGridSection(
                            title = stringResource(R.string.scents_title),
                            viewAllText = stringResource(R.string.show_all_scents_text),
                            items = uiState.topScentGroups,
                            imageFinder = { uiState.images[it] },
                            onClick = { termId, title ->
                                navigateToProductList(
                                    mapOf(
                                        PRODUCT_ARG_ATTRIBUTE to "pa_scent-group",
                                        PRODUCT_ARG_ATTRIBUTE_TERM to termId.toString(),
                                        PRODUCT_ARG_TITLE to title
                                    )
                                )
                                //onNavigateToProductList(null, "pa_scent-group", termId, title)
                            },
                            onShopAllClick = {
                                viewModel.goToAllScentGroups()
                            }
                        )
                    }

                    item {
                        PerfumeSpotlightSection(
                            spotlightTerms = uiState.perfumeSeasonTerms,
                            title = stringResource(R.string.seasons_title),
                            imageFinder = { uiState.images[it] },
                            onCategoryClick = { termId, title ->
                                navigateToProductList(
                                    mapOf(
                                        PRODUCT_ARG_ATTRIBUTE to "pa_season",
                                        PRODUCT_ARG_ATTRIBUTE_TERM to termId.toString(),
                                        PRODUCT_ARG_TITLE to title
                                    )
                                )
//                                onNavigateToProductList(null, "pa_season", termId, title)
                            },
                            onShopAllPerfumesClick = {
                                navigateToProductList(
                                    mapOf(
                                        PRODUCT_ARG_CATEGORY to PERFUME_CAT_ID,
                                        PRODUCT_ARG_TITLE to allPerfumeTitle
                                    )
                                )
                            }
                        )
                    }

                    item {
                        HorizontalDivider(
                            thickness = 0.5.dp,
                            color = MaterialTheme.colorScheme.outlineVariant.copy(alpha = 0.3f),
                            modifier = Modifier.padding(horizontal = 16.dp)
                        )
                    }

                    // --- Shoe Brands ---
                    if (uiState.showShoes)
                        item {
                            SmallItemsSection(
                                title = stringResource(R.string.shoe_brands_title),
                                items = uiState.shoeBrands,
                                onClick = { brandId, title ->
                                    navigateToProductList(
                                        mapOf(
                                            PRODUCT_ARG_BRAND_ID to brandId.toString(),
                                            PRODUCT_ARG_TITLE to title,
                                        )
                                    )
                                    //onNavigateToProductList(brandId, null, null, title)
                                },
                                onViewAllClick = {
                                    navigateToProductList(
                                        mapOf(
                                            PRODUCT_ARG_CATEGORY to SHOES_CAT_ID,
                                            PRODUCT_ARG_TITLE to allShoesTitle
                                        )
                                    )
                                },
                                viewAllText = allShoesTitle
                            )
                        }

                    item { Spacer(modifier = Modifier.height(16.dp)) } // Bottom padding
                }
            }

            CategoryDisplayType.ALL_BRANDS -> {
                AllItemsScreen(
                    title = stringResource(R.string.show_all_brands_text),
                    items = uiState.allBrands,
                    imageFinder = { uiState.images[it] },
                    onItemClick = { brandId, title ->
                        navigateToProductList(
                            mapOf(
                                PRODUCT_ARG_BRAND_ID to brandId.toString(),
                                PRODUCT_ARG_TITLE to title,
                            )
                        )
                    },
                    onBack = { viewModel.backToMainDisplay() }
                )
            }

            CategoryDisplayType.ALL_SCENT_GROUPS -> {
                AllItemsScreen(
                    title = stringResource(R.string.show_all_scents_text),
                    items = uiState.allScentGroups,
                    imageFinder = { uiState.images[it] },
                    onItemClick = { termId, title ->
                        navigateToProductList(
                            mapOf(
                                PRODUCT_ARG_ATTRIBUTE to "pa_scent-group",
                                PRODUCT_ARG_ATTRIBUTE_TERM to termId.toString(),
                                PRODUCT_ARG_TITLE to title
                            )
                        )
                    },
                    onBack = { viewModel.backToMainDisplay() }

                )
            }
        }

    }

}

@Composable
fun PerfumeSpotlightSection(
    spotlightTerms: List<AttributeTerm>,
    title: String,
    imageFinder: (Int) -> String? = { null },
    onCategoryClick: (categoryId: Int, title: String) -> Unit,
    onShopAllPerfumesClick: () -> Unit
) {
    Column(modifier = Modifier.fillMaxWidth()) {
        SectionHeader(
            title = title,
            onViewAllClick = onShopAllPerfumesClick,
            viewAllText = stringResource(R.string.all_perfumes_title)
        )

        // Spotlight categories (e.g., For Him, For Her) could be larger cards or a LazyRow
        LazyRow(
            contentPadding = PaddingValues(horizontal = 16.dp),
            horizontalArrangement = Arrangement.spacedBy(12.dp)
        ) {
            items(spotlightTerms, key = { it.id }) { term ->
                SpotlightCategoryCard(
                    term = term,
                    image = imageFinder(term.id),
                    onClick = { onCategoryClick(term.id, term.name) })
            }
        }
    }
}

@Composable
fun SpotlightCategoryCard(
    term: AttributeTerm,
    onClick: () -> Unit,
    modifier: Modifier = Modifier,
    image: String? = null
) {
    Card(
        onClick = onClick,
        modifier = modifier
            .width(280.dp)
            .height(180.dp), // Larger cards for spotlight
        shape = RoundedCornerShape(16.dp),
        elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)
    ) {
        Box {
            AsyncImage(
                model = ImageRequest.Builder(LocalContext.current)
                    .data(
                        image ?: ""
                    ) // Fallback color
                    .crossfade(true)
                    .build(),
                contentDescription = term.name,
                contentScale = ContentScale.Crop,
                modifier = Modifier.fillMaxSize()
            )

            Box( // Gradient overlay for text readability
                modifier = Modifier
                    .fillMaxSize()
                    .background(
                        Brush.verticalGradient(
                            colors = listOf(Color.Transparent, Color.Black.copy(alpha = 0.6f)),
                            startY = 180f * 0.4f // Gradient starts from 40% height
                        )
                    )
            )
            Text(
                text = term.name,
                fontSize = MaterialTheme.typography.headlineSmall.fontSize,
                color = Color.White,
                modifier = Modifier
                    .align(Alignment.BottomStart)
                    .padding(16.dp)
            )
        }
    }
}

@Composable
fun ItemGridSection(
    title: String,
    viewAllText: String = "All Categories",
    items: List<DisplayableTerm>,
    imageFinder: (Int) -> String? = { null },
    onClick: (termId: Int, title: String) -> Unit,
    onShopAllClick: () -> Unit
) {
    Column(modifier = Modifier.fillMaxWidth()) {
        SectionHeader(title = title, onViewAllClick = onShopAllClick, viewAllText = viewAllText)

        // Using a simple Row for a few items, or a FlowRow for more. Max 2 per row for visual appeal.
        // Or a LazyVerticalGrid if many categories. For this example, simple rows:
        items.chunked(2).forEach { rowCategories ->
            Row(
                modifier = Modifier
                    .fillMaxWidth()
                    .padding(horizontal = 16.dp),
                horizontalArrangement = Arrangement.spacedBy(12.dp)
            ) {
                rowCategories.forEach { term ->
                    MediumItemCard(
                        term = term,
                        image = imageFinder(term.id),
                        onClick = { onClick(term.id, term.name) },
                        modifier = Modifier.weight(1f)
                    )
                }
                if (rowCategories.size == 1) { // Fill space if only one item in last row
                    Spacer(modifier = Modifier.weight(1f))
                }
            }
            Spacer(modifier = Modifier.height(12.dp))
        }
    }
}

@Composable
fun MediumItemCard(
    term: DisplayableTerm,
    modifier: Modifier = Modifier,
    image: String? = null,
    onClick: () -> Unit
) {
    Card(
        onClick = onClick,
        modifier = modifier.aspectRatio(2f), // Square-ish cards
        shape = RoundedCornerShape(12.dp),
        colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surfaceVariant),
        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)
    ) {
        Box {
            AsyncImage(
                model = ImageRequest.Builder(LocalContext.current)
                    .data(
                        term.imageUrl ?: image ?: ""
                    ) // Fallback color
                    .crossfade(true)
                    .build(),
                contentDescription = term.name,
                contentScale = ContentScale.Crop,
                modifier = Modifier.fillMaxSize()
            )
            Box( // Gradient overlay for text readability
                modifier = Modifier
                    .fillMaxSize()
                    .background(
                        Brush.radialGradient(
                            colors = listOf(
                                Color.Gray.copy(alpha = 0.1f),
                                Color.Black.copy(alpha = 0.4f)
                            ),
                            radius = 200f
                            //startY = 180f * 0.4f // Gradient starts from 40% height
                        )
                    )
            )
            Text(
                text = term.name,
                fontSize = MaterialTheme.typography.labelLarge.fontSize,
                maxLines = 1,
                color = Color.White,
                modifier = Modifier
                    .align(Alignment.Center)
            )

            Text(
                text = "(${term.count})",
                fontSize = MaterialTheme.typography.labelMedium.fontSize,
                maxLines = 1,
                color = Color.White,
                modifier = Modifier
                    .align(Alignment.BottomCenter)
                    .padding(8.dp)
            )
        }
    }
}

@Composable
fun SmallItemsSection(
    title: String,
    items: List<DisplayableTerm>,
    imageFinder: (Int) -> String? = { null },
    onClick: (id: Int, title: String) -> Unit,
    onViewAllClick: () -> Unit,
    viewAllText: String = "View All"
) {
    Column(modifier = Modifier.fillMaxWidth()) {
        SectionHeader(title = title, onViewAllClick = onViewAllClick, viewAllText = viewAllText)
        LazyRow(
            contentPadding = PaddingValues(horizontal = 16.dp),
            horizontalArrangement = Arrangement.spacedBy(12.dp)
        ) {
            items(items, key = { it.id }) { item ->
                SmallItemCard(
                    item = item,
                    image = imageFinder(item.id),
                    onClick = { onClick(item.id, item.name) }
                )
            }
        }
    }
}

@Composable
fun SmallItemCard(
    item: DisplayableTerm,
    modifier: Modifier = Modifier,
    image: String? = null,
    onClick: () -> Unit
) {
    Box(
        // Using OutlinedCard for a slightly different feel for brands
        //onClick = onClick,
        modifier = modifier
            .width(100.dp)
            .clickable { onClick() }, // Fixed width for brand logos
        //shape = RoundedCornerShape(8.dp),
        //border = BorderStroke(1.dp, MaterialTheme.colorScheme.outline.copy(alpha = 0.5f))
    ) {
        Column(
            modifier = Modifier.padding(vertical = 12.dp, horizontal = 8.dp),
            horizontalAlignment = CenterHorizontally,
            verticalArrangement = Arrangement.Center
        ) {
            AsyncImage(
                model = ImageRequest.Builder(LocalContext.current)
                    .data(
                        item.imageUrl ?: image
                        ?: ColorPainter(MaterialTheme.colorScheme.secondaryContainer)
                    ) // Placeholder
                    .crossfade(true)
                    .build(),
                contentDescription = item.name,
                modifier = Modifier
                    .size(60.dp)
                    .align(CenterHorizontally),
                // Adjust size as needed
                //.clip(CircleShape), // Circular logos
                contentScale = ContentScale.Fit
            )
            Spacer(modifier = Modifier.height(8.dp))
            Text(
                text = item.name,
                fontSize = MaterialTheme.typography.labelLarge.fontSize,
                maxLines = 1,
                textAlign = TextAlign.Center,
                color = MaterialTheme.colorScheme.onSurfaceVariant
            )
        }
    }
}

@Composable
fun SectionHeader(title: String, onViewAllClick: () -> Unit, viewAllText: String = "View All") {
    Row(
        modifier = Modifier
            .fillMaxWidth()
            .padding(horizontal = 16.dp, vertical = 8.dp),
        verticalAlignment = Alignment.CenterVertically,
        horizontalArrangement = Arrangement.SpaceBetween
    ) {
        Text(
            text = title,
            style = MaterialTheme.typography.titleLarge,
            fontWeight = FontWeight.SemiBold
        )
        TextButton(onClick = onViewAllClick) {
            Text(viewAllText, fontWeight = FontWeight.Medium)
            Icon(
                Icons.AutoMirrored.Filled.ArrowForward,
                contentDescription = null,
                modifier = Modifier
                    .size(18.dp)
                    .padding(start = 4.dp)
            )
        }
    }
}
